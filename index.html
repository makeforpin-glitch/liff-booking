<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LINE é ç´„ï¼ˆæœˆæ›†æ¸¬è©¦ï¼‰</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif; padding:24px; background:#f4f6f8; }
    .card { max-width:520px; margin:0 auto; background:#fff; border-radius:14px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
    .title { font-size:22px; font-weight:700; margin-bottom:8px; }
    .hint { color:#555; line-height:1.6; margin-bottom:16px; }
    label { display:block; margin-top:12px; font-weight:600; }
    input[type="date"] { width:100%; padding:10px; margin-top:8px; font-size:16px; border-radius:10px; border:1px solid #ccc; }
    .status { margin-top:16px; font-size:14px; color:#333; background:#f1f3f5; padding:10px; border-radius:10px; }
    .ok { color:#1e7e34; font-weight:600; }
    button { width:100%; margin-top:16px; padding:12px; font-size:16px; border-radius:10px; border:none; background:#111; color:#fff; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    hr { margin:20px 0; border:none; border-top:1px solid #eee; }
  </style>
</head>

<body>
  <div class="card">
    <div class="title">ğŸ“… LINE é ç´„ï¼ˆæœˆæ›†æ¸¬è©¦ï¼‰</div>

    <div class="hint">
      å¦‚æœä½ æ˜¯åœ¨ <b>LINE è£¡</b> çœ‹åˆ°é€™å€‹ç•«é¢ï¼Œä»£è¡¨ï¼š<br>
      âœ” Endpoint URL æ­£ç¢º<br>
      âœ” GitHub Pages æ­£å¸¸<br>
      âœ” LIFF SDK è¼‰å…¥æˆåŠŸ
    </div>

    <div id="liffStatus" class="status">LIFF åˆå§‹åŒ–ä¸­â€¦</div>

    <hr>

    <label for="datePicker">é¸æ“‡æ—¥æœŸ</label>
    <input id="datePicker" type="date">
    <div id="dateResult" class="status">å°šæœªé¸æ“‡æ—¥æœŸ</div>

    <button id="sendBtn" disabled>é€å‡ºæ—¥æœŸåˆ°ç³»çµ±</button>
    <div id="sendStatus" class="status"></div>
  </div>

  <script>
    /************ åªæ”¹é€™å…©è¡Œ ************/
    const LIFF_ID = "2008631386-AEejMove";
    const MAKE_WEBHOOK_URL = "https://hook.us2.make.com/kuwkwyhu9axcj37nj4yl2j4v52rlm726";
    /***********************************/

    let userProfile = null;
    let selectedDate = "";

    async function initLIFF() {
      const statusEl = document.getElementById("liffStatus");
      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        userProfile = await liff.getProfile();
        statusEl.innerHTML = `<span class="ok">LIFF åˆå§‹åŒ–æˆåŠŸ</span><br>ä½¿ç”¨è€…ï¼š${userProfile.displayName}`;
      } catch (err) {
        statusEl.textContent = "âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ LIFF ID";
        console.error(err);
      }
    }
    initLIFF();

    const datePicker = document.getElementById("datePicker");
    const dateResult = document.getElementById("dateResult");
    const sendBtn = document.getElementById("sendBtn");
    const sendStatus = document.getElementById("sendStatus");

    datePicker.addEventListener("change", () => {
      selectedDate = datePicker.value;
      if (!selectedDate) return;
      dateResult.textContent = `ä½ é¸æ“‡çš„æ—¥æœŸæ˜¯ï¼š${selectedDate}`;
      sendBtn.disabled = false;
    });

    sendBtn.addEventListener("click", async () => {
      if (!selectedDate || !userProfile) return;
      sendBtn.disabled = true;
      sendStatus.textContent = "é€å‡ºä¸­â€¦";

      try {
        const payload = {
          source: "liff",
          date: selectedDate,
          userId: userProfile.userId,
          displayName: userProfile.displayName
        };

        const res = await fetch(MAKE_WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error("Webhook failed");

        sendStatus.innerHTML = `<span class="ok">å·²é€å‡º</span>ï¼ˆ${selectedDate}ï¼‰`;
      } catch (e) {
        console.error(e);
        sendStatus.textContent = "âŒ é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
      } finally {
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
